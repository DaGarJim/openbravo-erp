<!--
 *************************************************************************
 * The contents of this file are subject to the Openbravo  Public  License
 * Version  1.0  (the  "License"),  being   the  Mozilla   Public  License
 * Version 1.1  with a permitted attribution clause; you may not  use this
 * file except in compliance with the License. You  may  obtain  a copy of
 * the License at http://www.openbravo.com/legal/license.html 
 * Software distributed under the License  is  distributed  on  an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
 * License for the specific  language  governing  rights  and  limitations
 * under the License. 
 * The Original Code is Openbravo ERP. 
 * The Initial Developer of the Original Code is Openbravo SLU 
 * All portions are Copyright (C) 2010 Openbravo SLU 
 * All Rights Reserved. 
 * Contributor(s):  ______________________________________.
 ************************************************************************
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Openbravo</title>
<link rel="shortcut icon" href="../../../../../web/images/favicon.ico" type="image/x-icon" id="favicon" />
<link rel="stylesheet" type="text/css" href="../../../../../web/skins/Default/Openbravo_ERP_250.css" id="paramCSS" />
<script language="JavaScript" src="../../../../../web/js/shortcuts.js" type="text/javascript"></script>
<script language="JavaScript" src="../../../../../web/js/utils.js" type="text/javascript"></script>
<script language="JavaScript" src="../../../../../web/js/windowKeyboard.js" type="text/javascript"></script>
<script language="JavaScript" src="../../../../../web/js/appStatus.js" type="text/javascript"></script>
<script language="JavaScript" src="../../../../../web/js/ajax.js" type="text/javascript"></script>
<script language="JavaScript" src="../utility/CheckCleanCache.js?cache=true" type="text/javascript"></script>
<script language="JavaScript" src="../utility/CheckCleanCache.js?cache=false" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript" id="cacheMsg">var cacheMsg = 'xx';</script>
<script language="JavaScript" type="text/javascript" id="browserMsg">var browserMsg = 'xx';</script>

<script type="text/javascript">
  function redirectWhenPopup() {
    var permission = false;
    try {
      if (top.opener.parent.frames['appFrame']) {
        permission = true;
      }
    }
    catch (e) {}
    if (permission && top.opener) {
      top.opener.parent.location.href = top.document.location.href;
      top.window.close();
    }
  }

  function redirectWhenInsideMDI() {
    if (typeof isWindowInMDIPage !== 'undefined' && isWindowInMDIPage) {
      var LayoutMDI = null;
      if (isWindowInMDIPopup && parent.opener) {
        LayoutMDI = parent.opener.getFrame('LayoutMDI'); // Since getFrame('LayoutMDI') function frameset checks equals the current opened Login_FS.html modal popup
      } else {
        LayoutMDI = getFrame('LayoutMDI');
      }
      if (LayoutMDI && typeof parent.document.getElementById('framesetMenu') === 'object') {
        LayoutMDI.location.href = parent.window.location.href;
      }
    }
  }

  function hideMenuFrame() {
    if (parent.document.getElementById('framesetMenu')) {
      parent.document.getElementById('framesetMenu').cols = parent.document.getElementById('framesetMenu').cols.replace(parent.menuWidth, '0%');
    }
  }
</script>
<script type="text/javascript">
  function setLoginMessage(type, text) {
    if (type === 'Error') {
      var msgContainer = document.getElementById('errorMsg');
      msgContainer.innerHTML = text.replace(/\n/g, '<br>').replace(/\\n/g, '<br>');
      msgContainer.style.display = '';
    } else if (type === 'Warning') {
      alert(text.replace(/<br>/g, '\n'));
    }
  }

  function resetMessage(){
    var msgContainer = document.getElementById('errorMsg');
    msgContainer.innerHTML = '';
    msgContainer.style.display = 'none';
  }
</script>
<script type="text/javascript">
  function buttonOK_click() {
    if (focusedWindowElement.id === "user" && document.getElementById('user').value === "") {
      return true;
    } else if (focusedWindowElement.id === "user" && document.getElementById('password').value === "") {
      setTimeout(function() { // To manage browser autocomplete feature
       if (focusedWindowElement.id === "user" && document.getElementById('password').value === "") {
         setWindowElementFocus(document.getElementById('password')) 
       } else {
         return true;
       }
      }, 10);
    } else if (focusedWindowElement.id === "password" && document.getElementById('password').value === "") {
      return true;
    } else if (focusedWindowElement.id === "password" && document.getElementById('user').value === "") {
      setWindowElementFocus(document.getElementById('user'))
    } else {
      disableButton('buttonOK');
      submitXmlHttpRequest(loginResult, document.frmIdentificacion, 'DEFAULT', '../secureApp/LoginHandler.html', false, null, null);
    }
    return false;
  }

  function loginResult(paramXMLParticular, XMLHttpRequestObj) {
     var strText = '';
     if (getReadyStateHandler(XMLHttpRequestObj, null, false)) {
       if (XMLHttpRequestObj.responseText) {
         strText = XMLHttpRequestObj.responseText;
       }
       strText = strText.toString();
       var result = eval('('+strText+')');
       processResult(result);
     }
  }

  function processResult(result){
    if (result.showMessage) {
      setLoginMessage(result.messageType, result.messageTitle + '\n' + result.messageText);
      document.getElementById('password').value = '';
      setWindowElementFocus('password', 'id');
    }

    if (!result.showMessage || result.messageType === 'Warning') {
      var target;
      try {
        if (parent.frameMenu) {
          target = '_parent';
        } else {
          target = '_self';
        }
      } catch (e) {
        target = '_self';
      }
      submitCommandForm('DEFAULT', false, null, result.target, target, true);
    } else {
      enableButton('buttonOK');
    }
  }
</script>
<script type="text/javascript">
  function beforeLoadDo() {
    redirectWhenPopup();
    redirectWhenInsideMDI();
    hideMenuFrame();
  }

  function onLoadDo() {
    this.windowTables = new Array(
      new windowTableId('client', 'buttonOK')
    );
    setWindowTableParentElement();
    enableShortcuts('edition');
    setWindowElementFocus('user', 'id');

    if ((!revisionControl('8847')) || (isOpsInstance() != isOpsInstanceCached())) {
      setLoginMessage('Warning', cacheMsg);
    }

    if (!checkBrowserCompatibility()) {
      setLoginMessage('Warning', browserMsg);
    }
  }
</script>
<script type="text/javascript">
  beforeLoadDo();
</script>
</head>
<body onload="onLoadDo();">

  <div class="Login_Main" id="client">

    <div class="container">

      <div class="logbox">
        <form method="post" action="../secureApp/LoginHandler.html" name="frmIdentificacion" id="frmFormulario" autocomplete="off">
            <input type="hidden" name="Command" value="" />
            
            <div style="height: 115px; text-align: center;">
              <div style="padding-top: 25px;"><a href="#" class="Login_Img_Link"><img class="Login_Logo_Company" src="../../../../../web/images/blank.gif" /></a></div>
            </div>
            <div style="height: 162px !important;">
              <dl>
                <dt>
                  <label for="user" class="LabelText Login_LabelText">User name</label>
                </dt>
                <dd>
                  <input class="dojoValidateValid Login_TextBox" type="text" maxlength="60" name="user" onKeyDown="resetMessage(); return true;" id="user"/>
                </dd>
                <dt>
                  <label for="password" class="LabelText Login_LabelText">Password</label>
                </dt>
                <dd>
                  <input class="dojoValidateValid Login_TextBox" type="password" maxlength="40" name="password" onKeyDown="resetMessage(); return true;" id="password"/>
                </dd>
              </dl>
              <div id="errorMsg" class="LabelText Login_ErrorMsg_LabelText" style="display: none;">The username or password you entered is not correct.</div>
            </div>
            <div class="button">
              <div>
                <button type="button" 
                  id="buttonOK" 
                  class="ButtonLink" 
                  onclick="buttonOK_click();" 
                  onfocus="buttonEvent('onfocus', this); window.status='Login'; return true;" 
                  onblur="buttonEvent('onblur', this);" 
                  onkeyup="buttonEvent('onkeyup', this);" 
                  onkeydown="buttonEvent('onkeydown', this);" 
                  onkeypress="buttonEvent('onkeypress', this);" 
                  onmouseup="buttonEvent('onmouseup', this);" 
                  onmousedown="buttonEvent('onmousedown', this);" 
                  onmouseover="buttonEvent('onmouseover', this); window.status='Login'; return true;" 
                  onmouseout="buttonEvent('onmouseout', this);">
                  <table class="Button" id="fieldTable">
                    <tr>
                      <td class="Button_left"><img class="Button_Icon Button_Icon_ok" alt="Login" title="Login" src="../../../../../web/images/blank.gif" border="0" id="fieldButton" /></td>
                      <td class="Button_text Button_width">Login</td>
                      <td class="Button_right"></td>
                    </tr>
                  </table>
                </button>
              </div>
            </div>

        </form>
      </div>
          
      <div class="login-top">
        <div>
          <img class="Main_NavBar_logo" src="../../../../../web/images/blank.gif" />
          <span style="margin-left: 520px; font-size: 70px; font-style: italic; font-weight: bold; color: #7F7F7F; font-family:'lucida sans',sans-serif;">3.0</span>
        </div>
        <span style="display: block; margin-top: 215px; color: #afafaf; font-size: .9em;line-height: 0.9em; width: 14em; text-align: center; padding-bottom: 34px;">&copy; Copyright Openbravo <br />
        2001-2010</span>
      </div>

      <div style="position: relative; left: 110px; text-align: center; width: 100%;">
        <div style="width: 260px; position: relative; float: left;">
          <div style="text-align: center;" class="LabelText Login_LabelText">For support, contact:</div>
          <div style="text-align: center;"><a href="#" class="Login_Img_Link"><img class="Login_Logo_Support" src="../../../../../web/images/blank.gif" /></a></div>
        </div>
        <div style="width: 350px; position: relative; float: left;">
          <div style="text-align: center;" class="LabelText Login_LabelText">Project hosted at:</div>
          <div style="text-align: center;"><a href="#" class="Login_Img_Link"><img class="Login_Logo_OBForge" src="../../../../../web/images/blank.gif" /></a></div>
        </div>
      </div>

    </div>

  </div>

</body>
</html>
