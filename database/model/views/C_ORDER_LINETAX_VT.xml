<?xml version="1.0"?>
<database name="VIEW C_ORDER_LINETAX_VT">
<view name="C_ORDER_LINETAX_VT"><![CDATA[
SELECT ol.AD_Client_ID, ol.AD_Org_ID, ol.IsActive, ol.Created, ol.CreatedBy, ol.Updated, ol.UpdatedBy,
  uom.AD_Language,
  ol.C_Order_ID, ol.C_OrderLine_ID, ol.C_Tax_ID,
  ol.Line,
  ol.QtyOrdered, uom.UOMSymbol,
  COALESCE(COALESCE(pt.Name, p.Name), ol.Description) AS Name, -- main line
  CASE WHEN COALESCE(pt.Name, p.Name) IS NOT NULL THEN ol.Description END AS Description, -- second line
  COALESCE(pt.DocumentNote, p.DocumentNote) AS DocumentNote, -- third line
    p.UPC, p.SKU, p.Value AS ProductValue,
  ra.Description AS ResourceDescription, -- forth line
  CASE WHEN i.IsDiscountPrinted='Y' THEN ol.PriceList END AS PriceList,
  CASE WHEN i.IsDiscountPrinted='Y' AND ol.PriceList>ol.PriceActual THEN (ol.PriceList-ol.PriceActual)/ol.PriceList*100 END AS Discount,
  ol.PriceActual, ol.LineNetAmt
FROM  C_OrderLine ol
  INNER JOIN C_UOM_Trl uom ON (ol.C_UOM_ID=uom.C_UOM_ID)
  INNER JOIN C_Order i ON (ol.C_Order_ID=i.C_Order_ID)
  LEFT OUTER JOIN M_Product p ON (ol.M_PRODUCT_ID=p.M_PRODUCT_ID)
  LEFT OUTER JOIN M_Product_Trl pt ON (ol.M_PRODUCT_ID=pt.M_PRODUCT_ID AND uom.AD_Language=pt.AD_Language)
  LEFT OUTER JOIN S_ResourceAssignment ra ON (ol.S_ResourceAssignment_ID=ra.S_ResourceAssignment_ID)
UNION
SELECT ol.AD_Client_ID, ol.AD_Org_ID, ol.IsActive, ol.Created, ol.CreatedBy, ol.Updated, ol.UpdatedBy,
  uom.AD_Language,
  ol.C_Order_ID, ol.C_OrderLine_ID, ol.C_Tax_ID,
  ol.Line+(b.Line/100) AS Line,
  ol.QtyOrdered*b.BOMQty AS QtyInvoiced,
  uom.UOMSymbol,
  COALESCE(pt.Name, p.Name) AS Name,  -- main
  b.Description,
  COALESCE(pt.DocumentNote, p.DocumentNote) AS DocumentNote, p.UPC, p.SKU, p.Value AS ProductValue,
  null, null, null, null, null
FROM M_Product_BOM b  -- BOM lines
  INNER JOIN C_OrderLine ol ON (b.M_Product_ID=ol.M_Product_ID)
  INNER JOIN M_Product bp ON (bp.M_Product_ID=ol.M_Product_ID -- BOM Product
    AND bp.IsBOM='Y' AND bp.IsVerified='Y' AND bp.IsInvoicePrintDetails='Y')
  INNER JOIN M_Product p ON (b.M_ProductBOM_ID=p.M_Product_ID) -- BOM line product
  INNER JOIN C_UOM_Trl uom ON (p.C_UOM_ID=uom.C_UOM_ID)
  INNER JOIN M_Product_Trl pt ON (b.M_ProductBOM_ID=pt.M_Product_ID AND uom.AD_Language=pt.AD_Language)
UNION
SELECT o.AD_Client_ID, o.AD_Org_ID, o.IsActive, o.Created, o.CreatedBy, o.Updated, o.UpdatedBy,
  l.AD_Language, o.C_Order_ID, null, null,
  null,
  null, null,
  null,
  null, null, null, null, null, null,
  null, null, null, null
FROM C_Order o, AD_Language l
WHERE l.IsBaseLanguage='N' AND l.IsSystemLanguage='Y'
UNION
SELECT ot.AD_Client_ID, ot.AD_Org_ID, ot.IsActive, ot.Created, ot.CreatedBy, ot.Updated, ot.UpdatedBy,
  l.AD_Language, ot.C_Order_ID, null, ot.C_Tax_ID,
  null,
  null, null,
  t.Name,
  null, null, null, null, null, null,
  null,null, ot.TaxBaseAmt, ot.TaxAmt
FROM C_OrderTax ot
  INNER JOIN C_Tax t ON (ot.C_Tax_ID=t.C_Tax_ID), AD_Language l
WHERE l.IsBaseLanguage='N' AND l.IsSystemLanguage='Y'
]]></view>
</database>