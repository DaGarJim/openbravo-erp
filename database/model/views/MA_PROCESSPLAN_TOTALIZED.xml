<?xml version="1.0"?>
  <database name="VIEW MA_PROCESSPLAN_TOTALIZED">
    <view name="MA_PROCESSPLAN_TOTALIZED" updatable="false">
SELECT MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_ID, MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID,
  M_PRODUCT.M_PRODUCT_ID AS produced, sp1.qty AS proqty, sp2.M_PRODUCT_ID AS dependantproduct, sp2.qty AS depqty
FROM M_PRODUCT, MA_PROCESSPLAN_VERSION,
  (SELECT MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID, MA_SEQUENCEPRODUCT.M_PRODUCT_ID,
     SUM(CASE MA_SEQUENCEPRODUCT.PRODUCTIONTYPE
         WHEN '+' THEN MA_SEQUENCEPRODUCT.QUANTITY * MA_SEQUENCE.MULTIPLIER
         WHEN '-' THEN MA_SEQUENCEPRODUCT.QUANTITY * MA_SEQUENCE.MULTIPLIER*-1
         END) AS QTY
   FROM MA_PROCESSPLAN_VERSION, MA_SEQUENCE, MA_SEQUENCEPRODUCT
   WHERE MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID = MA_SEQUENCE.MA_PROCESSPLAN_VERSION_ID
     AND MA_SEQUENCE.MA_SEQUENCE_ID = MA_SEQUENCEPRODUCT.MA_SEQUENCE_ID
   GROUP BY MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID, MA_SEQUENCEPRODUCT.M_PRODUCT_ID
   ) sp1,
   (SELECT MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID, MA_SEQUENCEPRODUCT.M_PRODUCT_ID,
    SUM(CASE MA_SEQUENCEPRODUCT.PRODUCTIONTYPE
        WHEN '+' THEN MA_SEQUENCEPRODUCT.QUANTITY * MA_SEQUENCE.MULTIPLIER
        WHEN '-' THEN MA_SEQUENCEPRODUCT.QUANTITY * MA_SEQUENCE.MULTIPLIER*-1
        END) AS QTY
    FROM MA_PROCESSPLAN_VERSION, MA_SEQUENCE, MA_SEQUENCEPRODUCT
    WHERE MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID = MA_SEQUENCE.MA_PROCESSPLAN_VERSION_ID
      AND MA_SEQUENCE.MA_SEQUENCE_ID = MA_SEQUENCEPRODUCT.MA_SEQUENCE_ID
    GROUP BY MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID, MA_SEQUENCEPRODUCT.M_PRODUCT_ID
    ) sp2
WHERE M_PRODUCT.MA_PROCESSPLAN_ID = MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_ID
  AND MA_PROCESSPLAN_VERSION.DATEFROM &lt;= now()
  AND MA_PROCESSPLAN_VERSION.DATETO &gt; now()
  AND MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID = sp1.MA_PROCESSPLAN_VERSION_ID
  AND MA_PROCESSPLAN_VERSION.MA_PROCESSPLAN_VERSION_ID = sp2.MA_PROCESSPLAN_VERSION_ID
  AND sp1.M_PRODUCT_ID = M_PRODUCT.M_PRODUCT_ID
  AND sp2.M_PRODUCT_ID &lt;&gt; M_PRODUCT.M_PRODUCT_ID
  AND sp1.QTY &gt; 0
  AND sp2.QTY &lt;&gt;0
</view>
  </database>
