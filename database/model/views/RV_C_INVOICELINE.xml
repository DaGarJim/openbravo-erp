<?xml version="1.0"?>
  <database name="VIEW RV_C_INVOICELINE">
    <view name="RV_C_INVOICELINE"><![CDATA[
SELECT
  il.AD_Client_ID, il.AD_Org_ID,
  il.C_InvoiceLine_ID, i.C_Invoice_ID, i.SalesRep_ID,
  i.C_BPartner_ID, i.C_BP_Group_ID,
  il.M_Product_ID, p.M_Product_Category_ID,
  i.DateInvoiced, i.DateAcct,
  --  Qty
  il.QtyInvoiced*i.Multiplier AS QtyInvoiced,
  --  Item Amounts
  il.PriceList, il.PriceActual, il.PriceLimit,
  (CASE PriceList WHEN 0 THEN 0 ELSE
    ROUND((PriceList-PriceActual)/PriceList*100,2) END) AS Discount,
  (CASE PriceLimit WHEN 0 THEN 0 ELSE
    ROUND((PriceActual-PriceLimit)/PriceLimit*100,2) END) AS Margin,
  --  Line Amounts
  ROUND(i.Multiplier*LineNetAmt, 2) AS LineNetAmt,
  ROUND(i.Multiplier*PriceList*QtyInvoiced, 2) AS LineListAmt,
  (CASE WHEN il.PriceLimit IS NULL THEN ROUND(i.Multiplier*LineNetAmt,2) ELSE
    ROUND(i.Multiplier*PriceLimit*QtyInvoiced,2) END) AS LineLimitAmt,
  ROUND(i.Multiplier*PriceList*QtyInvoiced-LineNetAmt,2) AS LineDiscountAmt,
  (CASE WHEN il.PriceLimit IS NULL THEN 0 ELSE
    ROUND(i.Multiplier*LineNetAmt-PriceLimit*QtyInvoiced,2) END) AS LineOverLimitAmt
FROM  RV_C_Invoice i, C_InvoiceLine il, M_Product p
WHERE i.C_Invoice_ID=il.C_Invoice_ID
  AND il.M_Product_ID=p.M_Product_ID
]]></view>
  </database>
