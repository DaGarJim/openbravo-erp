<?xml version="1.0"?>
  <database name="FUNCTION C_TAX_FROM_NET_AMT">
    <function name="C_TAX_FROM_NET_AMT" type="NUMERIC">
      <parameter name="p_tax_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <parameter name="p_linenetamt" type="NUMERIC" mode="in">
        <default/>
      </parameter>
      <parameter name="p_alternatetaxbaseamt" type="NUMERIC" mode="in">
        <default/>
      </parameter>
      <parameter name="p_stdprecision" type="NUMERIC" mode="in">
        <default/>
      </parameter>
      <parameter name="p_totaltaxamt" type="NUMERIC" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[-- Logistice
  v_ResultStr VARCHAR(2000):=''; 
  v_Message VARCHAR2(2000):='';
  v_Result NUMBER:=1; -- 0=failure
  v_IsSummary C_TAX.ISSUMMARY%TYPE;
  v_Cascade C_TAX.CASCADE%TYPE;
  v_TaxBaseAmount NUMBER;
  v_TotalTaxAmt NUMBER;
  v_summary_tax NUMBER;
  v_BaseAmount C_TAX.BASEAMOUNT%TYPE;
  v_AlreadyExists NUMBER;
  v_C_TaxBase_ID C_TAX.C_TAXBASE_ID%TYPE;
  v_LineNet NUMBER;
  V_count NUMBER;
  v_AlternateTaxBaseAmt NUMBER;
  v_LineNo C_INVOICETAX.LINE%TYPE;
  v_Rate C_TAX.RATE%TYPE;
  v_Client_ID VARCHAR2(32) ;
  TYPE RECORD IS REF CURSOR;
    Cur_Taxes RECORD;
    FINISH_PROCESS BOOLEAN:=false;
  BEGIN --BODY
    v_TaxBaseAmount:=0;
    v_TotalTaxAmt:= p_TotalTaxAmt ; 
    
    SELECT ISSUMMARY, CASCADE, RATE, BASEAMOUNT, AD_CLIENT_ID, C_TAXBASE_ID
    INTO v_IsSummary, v_Cascade, v_Rate, v_BaseAmount, v_Client_ID, v_C_TaxBase_ID
    FROM C_TAX
    WHERE C_TAX_ID = p_tax_id;
    IF(v_BaseAmount='LNA' OR v_BaseAmount='LNATAX') THEN
      v_TaxBaseAmount:=p_LineNetAmt;
    ELSIF (v_BaseAmount='TBA' OR v_BaseAmount='TBATAX') THEN
     v_TaxBaseAmount:=p_AlternateTaxBaseAmt;
    END IF;
    IF (v_TaxBaseAmount IS NULL) THEN
      v_TaxBaseAmount:=0;
    END IF;
    
    IF (v_BaseAmount='TAX' OR v_BaseAmount='LNATAX' OR v_BaseAmount='TBATAX')  THEN
         
      v_TaxBaseAmount:=v_TaxBaseAmount+ c_tax_from_net_amt(v_C_TaxBase_ID , p_LineNetAmt, p_AlternateTaxBaseAmt, p_StdPrecision,v_TotalTaxAmt) ;
                 
    END IF;
    IF(v_Cascade='Y') THEN
       v_TaxBaseAmount:= v_TotalTaxAmt + v_TaxBaseAmount;
      
    END IF;
      
    
    IF(v_IsSummary='N') THEN
     return ROUND(v_TaxBaseAmount*v_Rate / 100, p_StdPrecision) ;
        
    ELSE
      v_summary_tax := 0 ;
      FOR Cur_Taxes IN
        (SELECT C_Tax_ID, RATE, name
         FROM C_TAX
        WHERE Parent_Tax_ID=p_tax_id
        ORDER BY Line)
      LOOP
        v_summary_tax:=  v_summary_tax + c_tax_from_net_amt( Cur_Taxes.C_Tax_ID, p_LineNetAmt, p_AlternateTaxBaseAmt, p_StdPrecision,v_TotalTaxAmt);
      END LOOP;
      RETURN v_summary_tax ;
    END IF;
    
EXCEPTION
WHEN OTHERS THEN
  v_ResultStr:= '@ERROR=' || SQLERRM;
  DBMS_OUTPUT.PUT_LINE(v_ResultStr) ;
  RAISE;
END C_TAX_FROM_NET_AMT
]]></body>
    </function>
  </database>
