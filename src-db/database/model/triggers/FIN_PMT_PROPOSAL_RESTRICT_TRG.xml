<?xml version="1.0"?>
  <database name="TRIGGER FIN_PMT_PROPOSAL_RESTRICT_TRG">
    <trigger name="FIN_PMT_PROPOSAL_RESTRICT_TRG" table="FIN_PAYMENT_PROPOSAL" fires="before" insert="true" update="true" delete="true" foreach="row">
      <body><![CDATA[

  
BEGIN
   
  IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF;

  IF UPDATING THEN
    IF(:OLD.PROCESSED='Y' AND ((COALESCE(:OLD.AD_ORG_ID, '0') <> COALESCE(:NEW.AD_ORG_ID, '0'))
      OR(COALESCE(:OLD.DOCUMENTNO, '0') <> COALESCE(:NEW.DOCUMENTNO, '0'))
      OR(COALESCE(:OLD.DESCRIPTION, '0') <> COALESCE(:NEW.DESCRIPTION, '0'))
      OR(COALESCE(:OLD.C_BPARTNER_ID, 0) <> COALESCE(:NEW.C_BPARTNER_ID, 0))
      OR(COALESCE(:OLD.FIN_PAYMENTMETHOD_ID, '0') <> COALESCE(:NEW.FIN_PAYMENTMETHOD_ID, '0'))
      OR(COALESCE(:OLD.FIN_FINANCIAL_ACCOUNT_ID, '0') <> COALESCE(:NEW.FIN_FINANCIAL_ACCOUNT_ID, '0'))
      OR(COALESCE(:OLD.AMOUNT, 0) <> COALESCE(:NEW.AMOUNT, 0))      
      OR(:OLD.PAYMENTDATE <> :NEW.PAYMENTDATE))) THEN
      RAISE_APPLICATION_ERROR(-20501, 'Document processed/posted') ;
    END IF;
  END IF;
 IF(INSERTING) THEN
   IF(:NEW.PROCESSED='Y') THEN
     RAISE_APPLICATION_ERROR(-20501, 'Document processed/posted') ;
   END IF;
  END IF;
  IF(DELETING) THEN
   IF(:OLD.PROCESSED='Y') THEN
     RAISE_APPLICATION_ERROR(-20501, 'Document processed/posted') ;
   END IF;
  END IF;
END FIN_PMT_PROPOSAL_RESTRICT_TRG]]></body>
    </trigger>
  </database>
